/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo_widgets.product.ProductPromotion"]){dojo._hasResource["dojo_widgets.product.ProductPromotion"]=true;dojo.provide("dojo_widgets.product.ProductPromotion");dojo.experimental("dojo_widgets.product.ProductPromotion");dojo.require("dijit.Dialog");dojo.require("dijit._Widget");dojo.declare("dojo_widgets.product.ProductPromotion",[dijit._Widget],{artistStore:null,artistSelect:null,DojoSearchField:null,DojoSearchSubmit:null,DojoRecordsField:null,SearchURL:null,theDialog:null,postCreate:function(){this.inherited(arguments);dojo.connect(dojo.byId("promotionadd"),"onclick",this,this.selectPromotion);this.productURL=location.pathname.split("/");dojo.connect(dijit.byId("product_promotions_contentPane"),"onload",this,"connectDelete");this.init();},init:function(){this.theDialog=new dijit.Dialog({id:"promotion_add",title:"Product Promotions"}),dojo.byId("promotion_add_dialog");return true;},selectPromotion:function(e){var _2=this;dojo.xhrGet({url:"/services/PromotionAdmin/"+this.productURL[3],handle:function(_3,_4){if(typeof _3=="error"){console.warn("error!",_4);}else{dojo.connect(dojo.byId("PromotionAdmin"),"onsubmit",_2,_2.formSubmit);_2.theDialog.setContent(_3);}}});this.theDialog.show();},formSubmit:function(e){var _6=this;e.preventDefault();var _7=dojo.xhrPost({form:"PromotionAdmin",handleAs:"text",handle:function(_8,_9){if(typeof _8=="error"){console.warn("error!",_9);}else{_6.theDialog.setContent(_8);_6.refreshPane();}}});},connectDelete:function(){var _a=this;dojo.query(".column_Delete a").forEach(function(_b,i){dojo.connect(_b,"onclick",_a,"doDelete");});},doDelete:function(e){dojo.stopEvent(e);hitURL("/services/ProductAdmin/delete/"+e.target.getAttribute("url"));this.refreshPane();},refreshPane:function(){dijit.byId("product_promotions_contentPane").setHref("/services/ProductAdmin/"+this.productURL[3]);this.connectDelete();}});}