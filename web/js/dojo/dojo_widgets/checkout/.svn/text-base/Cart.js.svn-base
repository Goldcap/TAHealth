/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo_widgets.checkout.Cart"]){dojo._hasResource["dojo_widgets.checkout.Cart"]=true;dojo.provide("dojo_widgets.checkout.Cart");dojo.experimental("dojo_widgets.checkout.Cart");dojo.require("dijit._Widget");dojo.require("dijit._Templated");dojo.declare("dojo_widgets.checkout.Cart",[dijit._Widget,dijit._Templated],{widgetID:null,theId:null,title:null,theDialog:null,content:null,showing:true,loaded:false,form:null,shipping_reqs:null,checkout:"normal",templateString:"<div dojoAttachPoint=\"CartContainer\"><div dojoAttachPoint=\"CartDialogContainer\"></div></div>",postCreate:function(){this.inherited(arguments);if(dojo.byId("Cart")){dojo.connect(dojo.byId("Cart"),"onsubmit",this,"doSubmit");}if(dojo.byId("cart")){dojo.connect(dojo.byId("cart"),"onsubmit",this,"doBillingSubmit");}if(dojo.byId("cart.help")){dojo.connect(dojo.byId("cart.help"),"onclick",this,"doHelp");}if(dojo.byId("cart.privacy")){dojo.connect(dojo.byId("cart.privacy"),"onclick",this,"doPrivacy");}if(dojo.byId("cart.continue")){dojo.connect(dojo.byId("cart.continue"),"onclick",this,"doContinue");}if(dojo.byId("cart.secure")){dojo.connect(dojo.byId("cart.secure"),"onclick",this,"doSecure");}if(dojo.byId("cart.secure_bottom")){dojo.connect(dojo.byId("cart.secure_bottom"),"onclick",this,"doSecure");}if(dojo.byId("cart.signin")){dojo.connect(dojo.byId("cart.signin"),"onclick",this,"doSignin");}if(dojo.byId("cart.phone")){dojo.connect(dojo.byId("cart.phone"),"onclick",this,"doPhone");}if(dojo.byId("cart.email")){dojo.connect(dojo.byId("cart.email"),"onclick",this,"doEmail");}if(dojo.byId("cart.terms")){dojo.connect(dojo.byId("cart.terms"),"onclick",this,"doTerms");}if(dojo.byId("checkout.security_code")){dojo.connect(dojo.byId("checkout.security_code"),"onclick",this,"doSecureCode");}if(dojo.byId("shipping_address_0")){dojo.connect(dojo.byId("shipping_address_0"),"onclick",this,"hideShipping");}if(dojo.byId("user_order_billing_country")){dojo.connect(dojo.byId("user_order_billing_country"),"onchange",this,"swapBillState");}if(dojo.byId("shipping_address_1")){dojo.connect(dojo.byId("shipping_address_1"),"onclick",this,"showShipping");if(dojo.byId("shipping_address_1").checked){this.showShipping();}}if(dojo.byId("cart")){this.action=dojo.attr(dojo.byId("cart"),"action");}if(dojo.byId("Cart")){this.action=dojo.attr(dojo.byId("Cart"),"action");}if(dojo.byId("checkout.tattoojohnny_set")){dojo.connect(dojo.byId("checkout.tattoojohnny_set"),"onclick",this,"setTattooJohnnyCheckout");}if(dojo.byId("checkout.paypal_set")){dojo.connect(dojo.byId("checkout.paypal_set"),"onclick",this,"setPaypalCheckout");}if(dojo.byId("checkout.paypal_do")){dojo.connect(dojo.byId("checkout.paypal_do"),"onclick",this,"checkoutPaypal");}this.shipping_reqs=new Array();var _1=this;dojo.query(".cart_recalculate").forEach(function(_2,i){dojo.connect(_2,"onclick",_1,"doRecalc");});},startup:function(){this.inherited(arguments);this.theDialog=new dijit.Dialog({id:"checkoutDialog",title:this.title}),this.CartDialogContainer;var _1=this;dojo.connect(this.theDialog,"onLoad",_1,_1.connectClose);},connectClose:function(){var _1=this;dojo.query(".dialog_close",_1.theDialog.containerNode).forEach(function(_2,i){dojo.connect(_2,"onclick",_1,_1.doClose);});},doClose:function(e){this.theDialog.hide();},doSubmit:function(e){dojo.stopEvent(e);var _5=true;var _6=true;if(document.forms["Cart"].elements["zip"].value==""){document.forms["Cart"].elements["zip"].className="inputtiny_error";var _5=false;}else{document.forms["Cart"].elements["zip"].className="inputtiny";}if(document.forms["Cart"].elements["country"].selectedIndex==0){document.forms["Cart"].elements["country"].className="countryselect_error";var _6=false;}else{document.forms["Cart"].elements["country"].className="countryselect";}dojo.attr(dojo.byId("Cart"),"action","/cart/calculate");if((_5)&&(_6)){document.forms["Cart"].submit();}},doBillingSubmit:function(e){dojo.stopEvent(e);var _8=checkForm(thisValidator,"cart");if(_8){dojo.attr(dojo.byId("cart"),"action","/cart/create");dojo.byId("SUBMIT_Review_order").disabled=true;document.forms["cart"].submit();}},doSignin:function(e){dojo.stopEvent(e);this.theDialog.setHref("/services/Login/form/cart/total");this.theDialog.show();},doPhone:function(e){dojo.stopEvent(e);this.theDialog.setHref("/services/Download/phone");this.theDialog.show();},doEmail:function(e){dojo.stopEvent(e);this.theDialog.setHref("/services/Download/email");this.theDialog.show();},doTerms:function(e){dojo.stopEvent(e);this.theDialog.setHref("/services/Download/terms");this.theDialog.show();},doSubmitShip:function(e){dojo.stopEvent(e);if(this.checkout=="normal"){dojo.attr(dojo.byId("cart"),"action",this.action);var _2=checkForm(thisValidator,"Download");if(_2){dojo.byId("SUBMIT_Proceed_to_Download").disabled=true;document.forms["Download"].submit();}var _e=true;if(document.forms["Cart"].elements["zip"].value==""){document.forms["Cart"].elements["zip"].className="inputtiny_error";_e=false;}else{document.forms["Cart"].elements["zip"].className="inputtiny";}if(document.forms["Cart"].elements["country"].selectedIndex==0){document.forms["Cart"].elements["country"].className="countryselect_error";_e=false;}else{document.forms["Cart"].elements["country"].className="countryselect";}dojo.attr(dojo.byId("Cart"),"action","/cart/submit");if(_e){document.forms["Cart"].submit();}}else{dojo.attr(dojo.byId("cart"),"action","https://www.paypal.com/cgi-bin/webscr");document.forms["cart"].submit();}},doRecalc:function(e){dojo.stopEvent(e);dojo.attr(dojo.byId("Cart"),"action","/cart/recalculate");document.forms["Cart"].submit();},doContinue:function(e){dojo.stopEvent(e);window.history.go(-1);},doHelp:function(e){dojo.stopEvent(e);this.theDialog.setHref("/services/Cart/help");this.theDialog.show();},doPrivacy:function(e){dojo.stopEvent(e);this.theDialog.setHref("/services/Cart/privacy");this.theDialog.show();},doSecureCode:function(e){dojo.stopEvent(e);this.theDialog.setHref("/services/Download/securecode");this.theDialog.show();},doSecure:function(e){dojo.stopEvent(e);this.theDialog.setHref("/services/Cart/secure");this.theDialog.show();},hideShipping:function(e){toggleDiv("shipping_wrapper");this.clearShipFields();},showShipping:function(e){var obj=this;if(this.shipping_container==null){this.shipping_container=new dijit.layout.ContentPane({id:"shipping_container_contentPane",onLoad:function(){dojo.hitch(obj.connectShip());}},dojo.byId("shipping_container"));this.shipping_container.setHref("/services/Cart/shipping");if((dojo.byId("user_id"))&&(dojo.byId("user_id").innerHTML!="")){this.shipping_container.setHref("/services/Cart/shipping/"+dojo.byId("user_id").innerHTML);}}else{this.setShipFields();}toggleDiv("shipping_wrapper");},connectShip:function(){if(dojo.byId("user_order_ship_country")){dojo.connect(dojo.byId("user_order_ship_country"),"onchange",this,"swapShipState");}},clearShipFields:function(){var obj=this;dojo.query("span[id^='vrequser_order_ship']").forEach(function(_19,i){_19.innerHTML="FALSE";},obj);dojo.byId("vrequser_order_ship_address_2").innerHTML="FALSE";},setShipFields:function(){var obj=this;dojo.query("span[id^='vrequser_order_ship']").forEach(function(_1c,i){_1c.innerHTML="TRUE";},obj);dojo.byId("vrequser_order_ship_address_2").innerHTML="VNN";},swapBillState:function(){if(dojo.byId("user_order_billing_country").selectedIndex!=1){dojo.style(dojo.byId("user_order_billing_state_select_div"),"display","none");dojo.style(dojo.byId("user_order_billing_state_text_div"),"display","block");dojo.byId("vrequser_order_billing_state_text").innerHTML="TRUE";dojo.byId("vrequser_order_billing_state_select").innerHTML="FALSE";}else{dojo.style(dojo.byId("user_order_billing_state_text_div"),"display","none");dojo.style(dojo.byId("user_order_billing_state_select_div"),"display","block");dojo.byId("vrequser_order_billing_state_text").innerHTML="FALSE";dojo.byId("vrequser_order_billing_state_select").innerHTML="TRUE";}},swapShipState:function(){if(dojo.byId("user_order_ship_country").selectedIndex!=1){dojo.style(dojo.byId("user_order_ship_state_select_div"),"display","none");dojo.style(dojo.byId("user_order_ship_state_text_div"),"display","block");dojo.byId("vrequser_order_ship_state_text").innerHTML="TRUE";dojo.byId("vrequser_order_ship_state_select").innerHTML="FALSE";}else{dojo.style(dojo.byId("user_order_ship_state_text_div"),"display","none");dojo.style(dojo.byId("user_order_ship_state_select_div"),"display","block");dojo.byId("vrequser_order_ship_state_text").innerHTML="FALSE";dojo.byId("vrequser_order_ship_state_select").innerHTML="TRUE";}},setTattooJohnnyCheckout:function(e){alert("THERE");this.checkout="normal";dojo.attr(dojo.byId("cart"),"action",this.action);},setPaypalCheckout:function(e){alert("HERE");this.checkout="paypal";dojo.attr(dojo.byId("cart"),"action","https://www.paypal.com/cgi-bin/webscr");},checkoutPaypal:function(e){dojo.stopEvent(e);this.setPaypalCheckout(e);this.doSubmit(e);}});}