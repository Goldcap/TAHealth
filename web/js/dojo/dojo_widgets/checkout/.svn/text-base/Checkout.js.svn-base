/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo_widgets.checkout.Checkout"]){dojo._hasResource["dojo_widgets.checkout.Checkout"]=true;dojo.provide("dojo_widgets.checkout.Checkout");dojo.experimental("dojo_widgets.checkout.Checkout");dojo.require("dijit._Widget");dojo.require("dijit._Templated");dojo.declare("dojo_widgets.checkout.Checkout",[dijit._Widget,dijit._Templated],{widgetID:null,theId:null,title:null,theDialog:null,content:null,showing:true,loaded:false,form:null,checkout:"normal",action:null,templateString:"<div dojoAttachPoint=\"CheckoutContainer\"><div dojoAttachPoint=\"CheckoutDialogContainer\"></div></div>",postCreate:function(){this.inherited(arguments);if(dojo.byId("checkout.signin")){dojo.connect(dojo.byId("checkout.signin"),"onclick",this,"doSignin");}if(dojo.byId("checkout.secure")){dojo.connect(dojo.byId("checkout.secure"),"onclick",this,"doSecure");}if(dojo.byId("checkout.phone")){dojo.connect(dojo.byId("checkout.phone"),"onclick",this,"doPhone");}if(dojo.byId("checkout.email")){dojo.connect(dojo.byId("checkout.email"),"onclick",this,"doEmail");}if(dojo.byId("checkout.security_code")){dojo.connect(dojo.byId("checkout.security_code"),"onclick",this,"doSecureCode");}if(dojo.byId("checkout.terms")){dojo.connect(dojo.byId("checkout.terms"),"onclick",this,"doTerms");}if(dojo.byId("checkout.secure_bottom")){dojo.connect(dojo.byId("checkout.secure_bottom"),"onclick",this,"doSecure");}if(dojo.byId("checkout.tattoojohnny_set")){dojo.connect(dojo.byId("checkout.tattoojohnny_set"),"onclick",this,"setTattooJohnnyCheckout");}if(dojo.byId("checkout.paypal_set")){dojo.connect(dojo.byId("checkout.paypal_set"),"onclick",this,"setPaypalCheckout");}if(dojo.byId("checkout.paypal_do")){dojo.connect(dojo.byId("checkout.paypal_do"),"onclick",this,"checkoutPaypal");}this.action=dojo.attr(dojo.byId("Download"),"action");if(dojo.byId("user_order_billing_country")){dojo.connect(dojo.byId("user_order_billing_country"),"onchange",this,"swapBillState");}this.swapBillState();},startup:function(){this.inherited(arguments);this.theDialog=new dijit.Dialog({id:"checkoutDialog",title:this.title}),this.CheckoutDialogContainer;var _1=this;dojo.connect(this.theDialog,"onLoad",_1,_1.connectClose);},connectClose:function(){var _1=this;dojo.query(".dialog_close",_1.theDialog.containerNode).forEach(function(_2,i){dojo.connect(_2,"onclick",_1,_1.doClose);});},doClose:function(e){this.theDialog.hide();},doSubmit:function(e){dojo.stopEvent(e);if(this.checkout=="normal"){dojo.attr(dojo.byId("Download"),"action","#");var _2=checkForm(thisValidator,"Download");if(_2){dojo.byId("SUBMIT_Proceed_to_Download").disabled=true;document.forms["Download"].submit();}}else{dojo.attr(dojo.byId("Download"),"action","https://www.paypal.com/cgi-bin/webscr");document.forms["Download"].submit();}},doSignin:function(e){dojo.stopEvent(e);this.theDialog.setHref("/services/Login/form/download/"+e.target.getAttribute("sku"));this.theDialog.show();},doSecure:function(e){dojo.stopEvent(e);this.theDialog.setHref("/services/Download/secure");this.theDialog.show();},doPhone:function(e){dojo.stopEvent(e);this.theDialog.setHref("/services/Download/phone");this.theDialog.show();},doEmail:function(e){dojo.stopEvent(e);this.theDialog.setHref("/services/Download/email");this.theDialog.show();},doSecureCode:function(e){dojo.stopEvent(e);this.theDialog.setHref("/services/Download/securecode");this.theDialog.show();},doTerms:function(e){dojo.stopEvent(e);this.theDialog.setHref("/services/Download/terms");dojo.style(this.theDialog.containerNode,{position:"relative"});this.theDialog.show();},setTattooJohnnyCheckout:function(e){this.checkout="normal";dojo.attr(dojo.byId("Download"),"action",this.action);},setPaypalCheckout:function(e){this.checkout="paypal";dojo.attr(dojo.byId("Download"),"action","https://www.paypal.com/cgi-bin/webscr");},checkoutPaypal:function(e){dojo.stopEvent(e);this.setPaypalCheckout(e);this.doSubmit(e);},swapBillState:function(){if(dojo.byId("user_order_billing_country").selectedIndex!=1){dojo.style(dojo.byId("user_order_billing_state_select_div"),"display","none");dojo.style(dojo.byId("user_order_billing_state_text_div"),"display","block");}else{dojo.style(dojo.byId("user_order_billing_state_text_div"),"display","none");dojo.style(dojo.byId("user_order_billing_state_select_div"),"display","block");}},swapShipState:function(){if(dojo.byId("user_order_ship_country").selectedIndex!=1){dojo.style(dojo.byId("user_order_ship_state_select_div"),"display","none");dojo.style(dojo.byId("user_order_ship_state_text_div"),"display","block");}else{dojo.style(dojo.byId("user_order_ship_state_text_div"),"display","none");dojo.style(dojo.byId("user_order_ship_state_select_div"),"display","block");}}});}