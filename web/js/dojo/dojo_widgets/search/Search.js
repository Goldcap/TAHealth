/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo_widgets.search.Search"]){dojo._hasResource["dojo_widgets.search.Search"]=true;dojo.provide("dojo_widgets.search.Search");dojo.experimental("dojo_widgets.search.Search");dojo.require("dijit.Dialog");dojo.require("dijit._Widget");dojo.declare("dojo_widgets.search.Search",[dijit._Widget],{artistStore:null,artistSelect:null,DojoSearchField:null,DojoSearchSubmit:null,DojoRecordsField:null,SearchURL:null,theDialog:null,postCreate:function(){this.inherited(arguments);this.DojoSearchField=document.forms["searchForm"].elements["key"];this.DojoSearchSubmit=dojo.byId("DojoSearchSubmit");this.DojoRecordsField=dojo.byId("DojoRecordsField");this.artistSelect=dojo.byId("artist_search");this.DojoSearchField.value="Enter Tattoo Keyword";dojo.connect(this.DojoSearchField,"onfocus",null,this.toggleSearchInputIn);dojo.connect(this.DojoSearchField,"onblur",null,this.toggleSearchInputOut);dojo.connect(this.DojoSearchSubmit,"onclick",this,this.submitSearch);dojo.connect(this.artistSelect,"onchange",this,this.submitSearch);if(dojo.byId("DojoSearchSuggestions")){dojo.connect(dojo.byId("DojoSearchSuggestions"),"onclick",this,this.showKeys);}if(dojo.byId("DojoSearchSuggestions")){dojo.connect(document,"onkeypress",this,this.doKeyPress);}this.SearchURL=location.pathname.split("/");this.update();this.init();},startup:function(){this.inherited(arguments);},submitSearch:function(e){dojo.stopEvent(e);this.doSearch();},doSearch:function(){var _2=new Array;var _3=new Array;if((this.artistSelect.value=="Search by Artist")&&((this.DojoSearchField.value=="")||(this.DojoSearchField.value=="Enter Tattoo Keyword"))){window.location="/search/featured?result=false";return false;}url="/search";if(this.DojoSearchField.value!="Enter Tattoo Keyword"){url=url+"/"+this.DojoSearchField.value;}if(this.artistSelect.value!="Search by Artist"){url=url+"/artist/"+this.artistSelect.value;}if(this.DojoRecordsField.value!=12){url=url+"/records/"+this.DojoRecordsField.value;}if(document.forms["searchForm"].elements["bw"].checked){_2[_2.length]="bw";}if(document.forms["searchForm"].elements["color"].checked){_2[_2.length]="color";}if(_2.length==1){url=url+"/cmap/"+_2.join(",");}if(document.forms["searchForm"].elements["small"].checked){_3[_3.length]="small";}if(document.forms["searchForm"].elements["medium"].checked){_3[_3.length]="medium";}if(document.forms["searchForm"].elements["large"].checked){_3[_3.length]="large";}if((_3.length>0)&&(_3.length<3)){url=url+"/size/"+_3.join(",");}if(document.forms["searchForm"].elements["adult_search"].checked){url=url+"/adult/true";}document.location.href=url;return false;},init:function(){if(dojo.byId("DojoSearchSuggestions")){this.theDialog=new dijit.Dialog({id:"keyword_suggestion_dialog",title:"Keyword Suggestions"}),dojo.byId("keyword_suggestions_dialog");var _4=this.theDialog;dojo.style(this.theDialog,"display","none");dojo.style(dojo.byId("keyword_suggestion_dialog"),"display","none");_5=dojo.byId("keywordsuggestions").innerHTML;_4.setContent(_5);dojo.byId("keywordsuggestions").innerHTML="";}return true;},setKeyword:function(){var s=document.forms["keyword_form"].elements["keyword_suggest_select"];var _6;var i;_6="";for(var i=1;i<s.length;i++){if(s.options[i].selected==true){_6=s.options[i].text;}}this.DojoSearchField.value=_6;this.doSearch();},toggleSearchInputIn:function(){(this.value=="Enter Tattoo Keyword")?this.value="":null;},toggleSearchInputOut:function(){(this.value=="")?this.value="Enter Tattoo Keyword":null;},update:function(){var _l=(dojo.byId("search_params"))?dojo.byId("search_params").innerHTML:false;if(_l!=""){var _9=dojo.fromJson(_l);}if(_9){var _7=(_9.cmap)?_9.cmap:false;var _8=(_9.size)?_9.size:false;var _d=(_9.adult)?_9.adult:false;var _a=(_9.records)?_9.records:false;var _b=(_9.artist)?_9.artist:false;var _r=(_9.op)?_9.op:false;}else{var _7=this.in_url("cmap");var _8=this.in_url("size");var _d=this.in_url("adult");var _a=this.in_url("records");var _b=this.in_url("artist");var _r=false;}var _r=(dojo.byId("search_term")&&dojo.byId("search_term").innerHTML!="")?dojo.byId("search_term").innerHTML:_r;if((_r!=false)&&(_r!="last")&&(_r!="Artist")){this.DojoSearchField.value=_r.replace("%20"," ");}if(_a!=false){var si;switch(_a){case "12":si=0;break;case "24":si=1;break;case "36":si=2;break;case "60":si=3;break;default:si=0;break;}this.DojoRecordsField.options[si].selected=true;}if(_d!=false){if(_d.match(/true/)){document.getElementById("adult_search").checked=true;}}if(_8!=false){if(!_8.match(/small/)){document.getElementById("small").checked=false;}if(!_8.match(/medium/)){document.getElementById("medium").checked=false;}if(!_8.match(/large/)){document.getElementById("large").checked=false;}}if(_7!=false){if(!_7.match(/bw/)){document.getElementById("bw").checked=false;}if(!_7.match(/color/)){document.getElementById("color").checked=false;}}if(_b!=false){for(i=1;i<this.artistSelect.options.length;i++){if(this.artistSelect.options[i].value==_b.replace("%20"," ")){this.artistSelect.selectedIndex=i;break;}}}},toggleDiv:function(_c){if((!dojo.style(_c,"display"))||(dojo.style(_c,"display")=="none")){var i=dojo.fadeIn({node:_c});dojo.connect(i,"beforeBegin",function(){dojo.style(_c,"opacity",0);dojo.style(_c,"display","block");});i.play();}else{var o=dojo.fadeOut({node:_c});dojo.connect(o,"onEnd",function(){dojo.style(_c,"opacity",0);dojo.style(_c,"display","none");});o.play();}},in_url:function(_f){var a=false;for(var i=0;i<this.SearchURL.length;i++){if(_f==this.SearchURL[i]){a=this.SearchURL[i+1];break;}}return a;},doKeyPress:function(e){switch(e.charOrCode){case dojo.keys.ENTER:dojo.stopEvent(e);this.submitSearch(e);break;}},showKeys:function(e){dojo.stopEvent(e);this.theDialog.show();dojo.style(this.theDialog,"display","block");dojo.style(dojo.byId("keyword_suggestion_dialog"),"display","block");dojo.connect(dojo.byId("keyword_suggest_submit"),"onclick",this,this.setSelectedKeyword);},setSelectedKeyword:function(e){dojo.stopEvent(e);this.DojoSearchField.value=dojo.byId("keyword_suggest_select").options[dojo.byId("keyword_suggest_select").selectedIndex].value;this.theDialog.hide();this.submitSearch(e);}});}